name: Validate Tag From Main

on:
  push:
    tags:
      - 'v*'

jobs:
  validate-tag:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch main
        run: git fetch origin main

      - name: Ensure tag is created from main HEAD
        run: |
          MAIN_HEAD=$(git rev-parse origin/main)
          echo "Main HEAD: $MAIN_HEAD"
          echo "Tag SHA:   $GITHUB_SHA"

          if [ "$GITHUB_SHA" != "$MAIN_HEAD" ]; then
            echo "ERROR: Tag must be created from main branch HEAD only."
            exit 1
          fi

          echo "Tag is valid."
